
---

**CombinedLoss パラメータ調整計画書**

**1. 目的**

本計画は、CombinedLoss関数 (`CombinedLoss(alpha=1, gamma=3, bce_weight=0.5, focal_weight=0.5)`) のパラメータ (`alpha`, `gamma`, `bce_weight`, `focal_weight`) を調整し、モデルのパフォーマンスを最適化することを目的とします。評価指標としてクロスバリデーション (CV) スコアを用い、週10回という限られた試行回数の中で効率的に最適なパラメータ組み合わせを探索します。

**2. 対象パラメータと初期値**

* `alpha`: 1 (クラスバランス調整用、ただし初期値1の挙動に注意)
* `gamma`: 3 (フォーカシングパラメータ)
* `bce_weight`: 0.5 (BCE損失の重み)
* `focal_weight`: 0.5 (Focal Lossの重み)

**3. 評価指標**

* クロスバリデーション (CV) スコア (値が高いほど良好と評価)

**4. 基本方針**

* **ベースライン測定:** まず初期パラメータでのCVスコアを測定し、比較基準とします。
* **段階的調整:** 影響が大きいと考えられるパラメータ (`bce_weight`/`focal_weight`, `gamma`) から順に調整します。
* **パラメータの分離:** 原則として、一度の試行で変更するパラメータは1種類に限定し、変更による影響を特定しやすくします。
* **結果の記録と活用:** 各試行のパラメータ設定とCVスコアを記録し、その結果を次の試行計画に反映させます。

**5. 試行計画 (全10回)**

以下の計画に従い、パラメータ調整を実施します。

**フェーズ1：ベースライン測定と損失バランスの探索 (試行1～4)**

| 試行回数   | alpha | gamma | bce\_weight | focal\_weight | 目的・メモ                            |
| :----- | :---- | :---- | :---------- | :------------ | :------------------------------- |
| 1      | 1     | 3     | 0.5         | 0.5           | **ベースライン測定 (初期値)**               |
| 2      | 1     | 3     | 0.2         | 0.8           | Focal Lossの影響を強める                |
| 3      | 1     | 3     | 0.8         | 0.2           | BCE Lossの影響を強める                  |
| 4      | 1     | 3     | 0.0         | 1.0           | Focal Loss単体での性能確認               |
| **評価** | -     | -     | -           | -             | 試行1～4の結果から、最適な`bce/focal`比率を見定める |

**フェーズ2：`gamma` 値の探索 (試行5～8)**

フェーズ1で特定した最適な `bce_weight`/`focal_weight` 比率を固定し、`gamma` の値を探索します。

| 試行回数   | alpha | gamma | bce\_weight | focal\_weight | 目的・メモ                           |
| :----- | :---- | :---- | :---------- | :------------ | :------------------------------ |
| 5      | 1     | 1     | (フェーズ1最適値)  | (フェーズ1最適値)    | `gamma`を下げ、フォーカス度合いを弱める         |
| 6      | 1     | 2     | (フェーズ1最適値)  | (フェーズ1最適値)    | `gamma`を少し下げ、フォーカス度合いをやや弱める     |
| 7      | 1     | 4     | (フェーズ1最適値)  | (フェーズ1最適値)    | `gamma`を上げ、フォーカス度合いを強める         |
| 8      | 1     | 5     | (フェーズ1最適値)  | (フェーズ1最適値)    | `gamma`をさらに上げ、フォーカス度合いをさらに強める   |
| **評価** | -     | -     | -           | -             | 最適な`gamma`値を見定める（ベースラインとの比較を含む） |

**フェーズ3：微調整と確認 (試行9～10)**

これまでの結果に基づき、最有望な設定の微調整、または`alpha`パラメータの影響を確認します。

| 試行回数   | alpha        | gamma        | bce\_weight | focal\_weight | 目的・メモ                                                                                      |
| :----- | :----------- | :----------- | :---------- | :------------ | :----------------------------------------------------------------------------------------- |
| 9      | (1 or 変更値)   | (フェーズ2最適値周辺) | (フェーズ1最適値)  | (フェーズ1最適値)    | **選択肢A:** 最適`gamma`値の周辺探索 (例: 3.5, 4.5)<br>**選択肢B:** `alpha`の影響確認 (例: 0.5) (クラス不均衡への効果期待時) |
| 10     | (試行9の結果による値) | (試行9の結果による値) | (フェーズ1最適値)  | (フェーズ1最適値)    | **最終確認:** 最良と思われる設定で再検証<br>**または:** 試行9で改善が見られた方向へさらに微調整                                   |
| **評価** | -            | -            | -           | -             | 全10回の試行から最もCVスコアが高かったパラメータ設定を採用                                                            |

**6. 結果の記録**

以下の形式で、各試行のパラメータ設定と得られたCVスコアを記録・管理します。

| 試行回数 | alpha | gamma | bce\_weight | focal\_weight | CVスコア | メモ・考察                           |
| :--- | :---- | :---- | :---------- | :------------ | :---- | :------------------------------ |
| 1    | 1     | 3     | 0.5         | 0.5           |       | ベースライン                          |
| 2    | 1     | 3     | 0.2         | 0.8           |       | Focal重視                         |
| 3    | 1     | 3     | 0.8         | 0.2           |       | BCE重視                           |
| 4    | 1     | 3     | 0.0         | 1.0           |       | Focalのみ                         |
| 5    |       |       |             |               |       | (フェーズ1の結果に基づき記載) gamma=1        |
| 6    |       |       |             |               |       | (フェーズ1の結果に基づき記載) gamma=2        |
| 7    |       |       |             |               |       | (フェーズ1の結果に基づき記載) gamma=4        |
| 8    |       |       |             |               |       | (フェーズ1の結果に基づき記載) gamma=5        |
| 9    |       |       |             |               |       | (フェーズ2の結果に基づき記載) 微調整 or alpha探索 |
| 10   |       |       |             |               |       | (試行9の結果に基づき記載) 最終確認 or さらなる微調整  |

---
